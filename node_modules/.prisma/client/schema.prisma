// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "cockroachdb"
  url      = env("DATABASE_URL")
}

model Widget {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
}

model User {
  id            Int         @id @default(sequence())
  username      String
  password      String
  name          String
  email         String
  age           Int?
  sex           String?
  height        Int?
  weight        Int?
  experience    Int?
  goals         String?
  equipment     Boolean?
  trainer       Boolean?
  profile_pic   String?
  online_status Boolean?

  posts         Post[]
  ai_chats      AiChat[]
  sent_messages DirectMessage[] @relation("SentMessages")
  received_messages DirectMessage[] @relation("ReceivedMessages")
}

model Post {
  id         Int      @id @default(sequence())
  user_id    Int
  title      String
  body       String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user       User     @relation(fields: [user_id], references: [id])
  photos     Photo[]
}

model Photo {
  id      Int      @id @default(sequence())
  post_id Int
  url     String

  post    Post     @relation(fields: [post_id], references: [id])
}

model AiChat {
  id         Int      @id @default(sequence())
  user_id    Int
  created_at DateTime @default(now())

  user       User     @relation(fields: [user_id], references: [id])
  chat_history AiChatHistory[]
}

model AiChatHistory {
  id         Int      @id @default(sequence())
  ai_chat_id Int
  created_at DateTime @default(now())
  message    String
  is_ai      Boolean

  ai_chat    AiChat   @relation(fields: [ai_chat_id], references: [id])
}

model DirectMessage {
  id         Int      @id @default(sequence())
  created_at DateTime @default(now())
  sender_id  Int
  recipient_id Int
  chat       String

  sender     User     @relation("SentMessages", fields: [sender_id], references: [id])
  recipient  User     @relation("ReceivedMessages", fields: [recipient_id], references: [id])
}